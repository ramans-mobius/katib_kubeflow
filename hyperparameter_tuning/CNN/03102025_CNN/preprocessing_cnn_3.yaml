name: CNN Data Preprocessing
description: Universal data preprocessing for CNN models

inputs:
  - name: data_path
    type: String
    description: Path to data
    
  - name: dataset_name
    type: String
    description: Name of the dataset
    
  - name: batch_size
    type: Integer
    description: Batch size for data loaders
    
  - name: validation_split
    type: Float
    description: Fraction of data to use for validation
    
  - name: input_size
    type: String
    description: Input image size as "width,height"

outputs:
  - name: output_path
    type: string
    description: Output path

implementation:
  container:
    image: nikhilv215/nesy-factory:v18
    command:
    - python3
    - -u
    - -c
    - |
      import os
      import sys
      print("=== CNN DATA PREPROCESSING ===")
      print(f"Data path: {sys.argv[1]}")
      print(f"Dataset name: {sys.argv[2]}")
      print(f"Batch size: {sys.argv[3]}")
      print(f"Validation split: {sys.argv[4]}")
      print(f"Input size: {sys.argv[5]}")
      print(f"Output file: {sys.argv[6]}")
      
      output_path = os.path.join(sys.argv[1], 'preprocessed')
      os.makedirs(output_path, exist_ok=True)
      
      with open(sys.argv[6], 'w') as f:
          f.write(output_path)
          
      print(f"Created output path: {output_path}")
      print("=== COMPLETED ===")
    
    args:
    - --data_path
    - {inputValue: data_path}
    - --dataset_name
    - {inputValue: dataset_name}
    - --batch_size
    - {inputValue: batch_size}
    - --validation_split
    - {inputValue: validation_split}
    - --input_size
    - {inputValue: input_size}
    - --output_path  
    - {outputPath: output_path}
