name: Upload to MinIO for CNN
description: Upload config.properties and cnn-classifier.mar files to MinIO bucket
inputs:
  - {name: config_file, type: String, description: "config.properties file path"}
  - {name: model_file, type: String, description: "cnn-classifier.mar file path"}
  - {name: minio_bucket, type: String, description: "MinIO bucket name", default: "models"}
  - {name: application_name, type: String, description: "Application name for path", default: "cnn-classifier"}
  - {name: minio_username, type: String, description: "MinIO username"}
  - {name: minio_password, type: String, description: "MinIO password"}
outputs:
  - {name: minio_path, type: String, description: "Output MinIO path"}
implementation:
  container:
    image: ubuntu:22.04
    command:
    - sh
    - -c
    - |
        set -e
        apt-get -o Acquire::ForceIPv4=true update
        apt-get -o Acquire::ForceIPv4=true install -y wget
        wget https://dl.min.io/client/mc/release/linux-amd64/mc
        chmod +x mc
        mv mc /usr/local/bin/
        mc alias set myminio http://minio-service.kubeflow.svc.cluster.local:9000 "$4" "$5"
        
        if ! mc ls myminio/"$2"; then
          mc mb myminio/"$2"
        fi
        
        # Copy files to temp location with proper names
        mkdir -p /tmp/upload
        cp "$0" /tmp/upload/config.properties
        cp "$1" /tmp/upload/cnn-classifier.mar
        
        # Upload to MinIO
        mc cp /tmp/upload/config.properties "myminio/$2/$3/config/config.properties"
        mc cp /tmp/upload/cnn-classifier.mar "myminio/$2/$3/model-store/cnn-classifier.mar"
        
        mkdir -p "$(dirname "$6")"
        echo "s3://$2/$3/" > "$6"
        echo "Upload completed successfully!"
    args:
    - {inputPath: config_file}
    - {inputPath: model_file}
    - {inputValue: minio_bucket}
    - {inputValue: application_name}
    - {inputValue: minio_username}
    - {inputValue: minio_password}
    - {outputPath: minio_path}
